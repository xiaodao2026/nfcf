# Netflix自动域名更新

YouTube：小道笔记
https://www.youtube.com/channel/UCfSvDIQ8D_Zz62oAd5mcDDg

# 背景
最近我遇到的问题就是我的vps时而可以解锁Netflix时而不可以解锁的问题。<br>
情况是这样的，我在新加坡有一台greencloud的vps，在美国有一台justhost，原本两台机器都可以解锁Netflix、disney和amazon prime video。<br>
考虑中文字幕因素，新加坡的这台vps一直是我的主用节点，但是近期遇到非常吊诡的情况，这台vps时而Netflix可以解锁时而不可以。<br>
使用就非常的不方便，我们一般的分流方式是针对节点的固定模式，客户端无法预先判断这个节点是否可以解锁使用。只能在登录Netflix发现无法解锁后手工切换其它节点。<br>
切到美国节点后，并不知道新加坡的节点什么时间恢复，经常需要来回尝试，非常繁琐。<br>

# 思路
1、我的想法就是配置一个二级域名，例如nf.xxxx.com，并将这个域名指向到我在新加坡的vps地址上。并在vps上运行一个脚本，定期检查本机是否支持Netflix解锁，并根据解锁的检查结果来调整nf.xxxx.com的指向。<br>
2、需要将机器上无论是v2ray还是trojan，都调整为相同的参数。<br>
3、在客户端只使用域名（nf.xxxx.com）配置，在使用过程中，无感vps不能解锁的问题。<br>

# 使用方法
备注：我之前没有接触过shell脚本的编写，此次就是照猫画虎，所以代码比较简陋，实现方式也比较的奇怪，不够科班，但是无论如何结果还是达到了。<br>

下面我们就来看看部署的过程：<br>

## 我们在cloudflare配置一个二级域名

登陆cloudflare后增加一个nf的域名，同时我们需要记录下两个信息，一个是CloudFlare注册账户邮箱（auth_email），一个是CloudFlare账户Globel ID（auth_key），记录这两个信息后，我们在后面的安装过程中会用到。

## 一键安装代码

```bash
bash <(curl -sL https://raw.githubusercontent.com/xiaodao2026/nfcf/main/nfcf.sh)
```

### 启动后会询问是安装还是卸载。
我们选择安装，按照提示输入cloudflare的信息。<br>
然后我们输入域名和子域名。<br>

### 关于优先级
可以默认输入110<br>
优先级不同的差别：<br>
1、如果两台机器配置相同的优先级，例如都是110，那么一台机器无法解锁后就更换为另外一台，一直使用另外一台直到也出现无法解锁时，才会切换回来。<br>
2、第一台配置为110，将另外一台配置为120，那么第一台无法解锁时切换第二台，一旦检测到第一台恢复，则回立刻切换回第一台。这种方式适合主服务速度比较好，位于香港、新加坡这种中文区域的机器。<br>
如果配置上述脚本的所有机器都无法解锁Netflix，脚本将暂停域名更新。<br>

### 运行间隔
安装完成以后，会自动配置一个定时器，默认是每20分钟执行一次。<br>
如果想自己修改执行间隔，可以手工修改。<br>

## 可以支持的运行环境
目前测试ubuntu20.04可以运行，其它环境未测试<br>
